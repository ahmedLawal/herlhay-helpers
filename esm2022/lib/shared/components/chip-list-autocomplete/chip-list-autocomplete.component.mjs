import { COMMA, ENTER } from '@angular/cdk/keycodes';
import { Component, Input, ViewChild } from '@angular/core';
import { FormControl, FormsModule, ReactiveFormsModule } from '@angular/forms';
import { MatAutocompleteModule } from '@angular/material/autocomplete';
import { MatChipsModule } from '@angular/material/chips';
import { merge } from 'rxjs';
import { debounceTime, filter, mergeMap, startWith } from 'rxjs/operators';
import { InputBasicComponent } from '../input/input.component';
import { FunctionCaller1 } from '../../pipes/utility.pipe';
import { MatOptionModule } from '@angular/material/core';
import { MatIconModule } from '@angular/material/icon';
import { NgFor, NgIf, AsyncPipe } from '@angular/common';
import { MatFormFieldModule } from '@angular/material/form-field';
import * as i0 from "@angular/core";
import * as i1 from "../input/input.service";
import * as i2 from "../autocomplete/autocomplete.service";
import * as i3 from "@angular/material/form-field";
import * as i4 from "@angular/material/chips";
import * as i5 from "@angular/material/icon";
import * as i6 from "@angular/forms";
import * as i7 from "@angular/material/autocomplete";
import * as i8 from "@angular/material/core";
export class ChipListAutocompleteComponent extends InputBasicComponent {
    constructor(iS, autoS) {
        super(iS);
        this.iS = iS;
        this.autoS = autoS;
        this.separatorKeysCodes = [ENTER, COMMA];
        this.autoCompleteCtrl = new FormControl('');
    }
    ngOnInit() {
        super.ngOnInit();
        merge(this.autoCompleteCtrl.valueChanges.pipe(startWith('')), this.options$)
            .pipe(
        // filter((r) => !this.filterFunc),
        mergeMap((r) => this.autoS.filterOptions(this.autoCompleteCtrl.value, this.options)))
            .subscribe((r) => {
            this.filteredOptions = r;
        });
        this.autoCompleteCtrl.valueChanges
            .pipe(startWith(''))
            .pipe(debounceTime(1000), filter((r) => !!this.filterFunc), mergeMap((r) => this.filterFunc(this.autoCompleteCtrl.value)))
            .subscribe((r) => {
            this._options = r;
        });
    }
    ngAfterViewInit() {
        super.ngAfterViewInit();
    }
    add(event) {
        // const value = (event.value || '').trim();
        // // Add our fruit
        // if (value) {
        //   this.control?.value.push(value);
        // }
        // // Clear the input value
        // event.chipInput!.clear();
        // this.autoCompleteCtrl.setValue(null);
    }
    remove(index) {
        this.control?.value.splice(index, 1);
    }
    selected(event) {
        delete this.message;
        if (!this.control?.value)
            this.control?.patchValue([]);
        if (this.control?.value?.includes(event.option.value)) {
            this.message = event.option.viewValue + ' has already been added';
        }
        else
            this.control?.value.push(event.option.value);
        // this.fruitInput.nativeElement.value = '';
        this.autoCompleteCtrl.setValue(null);
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "16.0.2", ngImport: i0, type: ChipListAutocompleteComponent, deps: [{ token: i1.InputService }, { token: i2.AutocompleteService }], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "16.0.2", type: ChipListAutocompleteComponent, isStandalone: true, selector: "chip-list-autocomplete", inputs: { filterFunc: "filterFunc", addedDataFormatter: "addedDataFormatter" }, viewQueries: [{ propertyName: "fruitInput", first: true, predicate: ["fruitInput"], descendants: true }], usesInheritance: true, ngImport: i0, template: "<mat-form-field class=\"example-chip-list\" appearance=\"fill\">\n    <mat-label>{{label}}</mat-label>\n    <mat-chip-grid #chipGrid attr.aria-label=\"{{label}} selection\">\n        <mat-chip-row *ngFor=\"let item of control.value;let i =index\" (removed)=\"remove(i)\">\n            {{(addedDataFormatter|functionCaller1:item|async)||item}}\n            <button matChipRemove [attr.aria-label]=\"'remove ' + item\">\n                <mat-icon>cancel</mat-icon>\n            </button>\n        </mat-chip-row>\n    </mat-chip-grid>\n    <input placeholder=\"{{placeholder||label}}\" #aInput [formControl]=\"autoCompleteCtrl\" [matChipInputFor]=\"chipGrid\"\n        [matAutocomplete]=\"auto\" [matChipInputSeparatorKeyCodes]=\"separatorKeysCodes\"\n        (matChipInputTokenEnd)=\"add($event)\" />\n    <mat-autocomplete #auto=\"matAutocomplete\" (optionSelected)=\"selected($event)\">\n        <mat-option *ngFor=\"let option of filteredOptions\" [value]=\"option.value\">\n            {{option.label}}\n        </mat-option>\n    </mat-autocomplete>\n</mat-form-field>\n<div class=\"text-danger\" *ngIf=\"message\">{{message}}</div>", styles: [".example-chip-list{width:100%;height:auto}.mat-mdc-form-field:focus-within input{background:transparent!important}.mat-mdc-form-field{background:transparent!important}\n"], dependencies: [{ kind: "ngmodule", type: MatFormFieldModule }, { kind: "component", type: i3.MatFormField, selector: "mat-form-field", inputs: ["hideRequiredMarker", "color", "floatLabel", "appearance", "subscriptSizing", "hintLabel"], exportAs: ["matFormField"] }, { kind: "directive", type: i3.MatLabel, selector: "mat-label" }, { kind: "ngmodule", type: MatChipsModule }, { kind: "component", type: i4.MatChipGrid, selector: "mat-chip-grid", inputs: ["tabIndex", "disabled", "placeholder", "required", "value", "errorStateMatcher"], outputs: ["change", "valueChange"] }, { kind: "directive", type: i4.MatChipInput, selector: "input[matChipInputFor]", inputs: ["matChipInputFor", "matChipInputAddOnBlur", "matChipInputSeparatorKeyCodes", "placeholder", "id", "disabled"], outputs: ["matChipInputTokenEnd"], exportAs: ["matChipInput", "matChipInputFor"] }, { kind: "directive", type: i4.MatChipRemove, selector: "[matChipRemove]" }, { kind: "component", type: i4.MatChipRow, selector: "mat-chip-row, [mat-chip-row], mat-basic-chip-row, [mat-basic-chip-row]", inputs: ["color", "disabled", "disableRipple", "tabIndex", "editable"], outputs: ["edited"] }, { kind: "directive", type: NgFor, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { kind: "ngmodule", type: MatIconModule }, { kind: "component", type: i5.MatIcon, selector: "mat-icon", inputs: ["color", "inline", "svgIcon", "fontSet", "fontIcon"], exportAs: ["matIcon"] }, { kind: "ngmodule", type: FormsModule }, { kind: "directive", type: i6.DefaultValueAccessor, selector: "input:not([type=checkbox])[formControlName],textarea[formControlName],input:not([type=checkbox])[formControl],textarea[formControl],input:not([type=checkbox])[ngModel],textarea[ngModel],[ngDefaultControl]" }, { kind: "directive", type: i6.NgControlStatus, selector: "[formControlName],[ngModel],[formControl]" }, { kind: "ngmodule", type: MatAutocompleteModule }, { kind: "component", type: i7.MatAutocomplete, selector: "mat-autocomplete", inputs: ["disableRipple", "hideSingleSelectionIndicator"], exportAs: ["matAutocomplete"] }, { kind: "component", type: i8.MatOption, selector: "mat-option", exportAs: ["matOption"] }, { kind: "directive", type: i7.MatAutocompleteTrigger, selector: "input[matAutocomplete], textarea[matAutocomplete]", exportAs: ["matAutocompleteTrigger"] }, { kind: "ngmodule", type: ReactiveFormsModule }, { kind: "directive", type: i6.FormControlDirective, selector: "[formControl]", inputs: ["formControl", "disabled", "ngModel"], outputs: ["ngModelChange"], exportAs: ["ngForm"] }, { kind: "ngmodule", type: MatOptionModule }, { kind: "directive", type: NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "pipe", type: AsyncPipe, name: "async" }, { kind: "pipe", type: FunctionCaller1, name: "functionCaller1" }] }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "16.0.2", ngImport: i0, type: ChipListAutocompleteComponent, decorators: [{
            type: Component,
            args: [{ selector: 'chip-list-autocomplete', standalone: true, imports: [
                        MatFormFieldModule,
                        MatChipsModule,
                        NgFor,
                        MatIconModule,
                        FormsModule,
                        MatAutocompleteModule,
                        ReactiveFormsModule,
                        MatOptionModule,
                        NgIf,
                        AsyncPipe,
                        FunctionCaller1,
                    ], template: "<mat-form-field class=\"example-chip-list\" appearance=\"fill\">\n    <mat-label>{{label}}</mat-label>\n    <mat-chip-grid #chipGrid attr.aria-label=\"{{label}} selection\">\n        <mat-chip-row *ngFor=\"let item of control.value;let i =index\" (removed)=\"remove(i)\">\n            {{(addedDataFormatter|functionCaller1:item|async)||item}}\n            <button matChipRemove [attr.aria-label]=\"'remove ' + item\">\n                <mat-icon>cancel</mat-icon>\n            </button>\n        </mat-chip-row>\n    </mat-chip-grid>\n    <input placeholder=\"{{placeholder||label}}\" #aInput [formControl]=\"autoCompleteCtrl\" [matChipInputFor]=\"chipGrid\"\n        [matAutocomplete]=\"auto\" [matChipInputSeparatorKeyCodes]=\"separatorKeysCodes\"\n        (matChipInputTokenEnd)=\"add($event)\" />\n    <mat-autocomplete #auto=\"matAutocomplete\" (optionSelected)=\"selected($event)\">\n        <mat-option *ngFor=\"let option of filteredOptions\" [value]=\"option.value\">\n            {{option.label}}\n        </mat-option>\n    </mat-autocomplete>\n</mat-form-field>\n<div class=\"text-danger\" *ngIf=\"message\">{{message}}</div>", styles: [".example-chip-list{width:100%;height:auto}.mat-mdc-form-field:focus-within input{background:transparent!important}.mat-mdc-form-field{background:transparent!important}\n"] }]
        }], ctorParameters: function () { return [{ type: i1.InputService }, { type: i2.AutocompleteService }]; }, propDecorators: { filterFunc: [{
                type: Input
            }], fruitInput: [{
                type: ViewChild,
                args: ['fruitInput']
            }], addedDataFormatter: [{
                type: Input
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2hpcC1saXN0LWF1dG9jb21wbGV0ZS5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9oZXJsaGF5LWhlbHBlcnMvc3JjL2xpYi9zaGFyZWQvY29tcG9uZW50cy9jaGlwLWxpc3QtYXV0b2NvbXBsZXRlL2NoaXAtbGlzdC1hdXRvY29tcGxldGUuY29tcG9uZW50LnRzIiwiLi4vLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvaGVybGhheS1oZWxwZXJzL3NyYy9saWIvc2hhcmVkL2NvbXBvbmVudHMvY2hpcC1saXN0LWF1dG9jb21wbGV0ZS9jaGlwLWxpc3QtYXV0b2NvbXBsZXRlLmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFDckQsT0FBTyxFQUFFLFNBQVMsRUFBYyxLQUFLLEVBQUUsU0FBUyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ3hFLE9BQU8sRUFBbUIsV0FBVyxFQUFFLFdBQVcsRUFBRSxtQkFBbUIsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ2hHLE9BQU8sRUFBZ0MscUJBQXFCLEVBQUUsTUFBTSxnQ0FBZ0MsQ0FBQztBQUNyRyxPQUFPLEVBQXFCLGNBQWMsRUFBRSxNQUFNLHlCQUF5QixDQUFDO0FBQzVFLE9BQU8sRUFBRSxLQUFLLEVBQWMsTUFBTSxNQUFNLENBQUM7QUFDekMsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLEVBQU8sUUFBUSxFQUFFLFNBQVMsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBRWhGLE9BQU8sRUFBRSxtQkFBbUIsRUFBVyxNQUFNLDBCQUEwQixDQUFDO0FBRXhFLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQUMzRCxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sd0JBQXdCLENBQUM7QUFDekQsT0FB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LEtBQUssQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUNwRCw0Q0FBNEM7UUFDNUMsSUFBSSxDQUFDLGdCQUFnQixDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUN2QyxDQUFDOzhHQTdFVSw2QkFBNkI7a0dBQTdCLDZCQUE2QixtU0NuQzFDLGtuQ0FtQjBELGtPREdsRCxrQkFBa0IsMFNBQ2xCLGNBQWMsMnlCQUNkLEtBQUssa0hBQ0wsYUFBYSxtTEFDYixXQUFXLHNaQUNYLHFCQUFxQixnY0FDckIsbUJBQW1CLGlOQUNuQixlQUFlLCtCQUNmLElBQUksd0ZBQ0osU0FBUyx5Q0FDVCxlQUFlOzsyRkFHViw2QkFBNkI7a0JBbkJ6QyxTQUFTOytCQUNJLHdCQUF3QixjQUd0QixJQUFJLFdBQ1A7d0JBQ0wsa0JBQWtCO3dCQUNsQixjQUFjO3dCQUNkLEtBQUs7d0JBQ0wsYUFBYTt3QkFDYixXQUFXO3dCQUNYLHFCQUFxQjt3QkFDckIsbUJBQW1CO3dCQUNuQixlQUFlO3dCQUNmLElBQUk7d0JBQ0osU0FBUzt3QkFDVCxlQUFlO3FCQUNsQjtxSUFXTSxVQUFVO3NCQUFsQixLQUFLO2dCQUNtQixVQUFVO3NCQUFsQyxTQUFTO3VCQUFDLFlBQVk7Z0JBRWQsa0JBQWtCO3NCQUExQixLQUFLIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ09NTUEsIEVOVEVSIH0gZnJvbSAnQGFuZ3VsYXIvY2RrL2tleWNvZGVzJztcbmltcG9ydCB7IENvbXBvbmVudCwgRWxlbWVudFJlZiwgSW5wdXQsIFZpZXdDaGlsZCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgQWJzdHJhY3RDb250cm9sLCBGb3JtQ29udHJvbCwgRm9ybXNNb2R1bGUsIFJlYWN0aXZlRm9ybXNNb2R1bGUgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XG5pbXBvcnQgeyBNYXRBdXRvY29tcGxldGVTZWxlY3RlZEV2ZW50LCBNYXRBdXRvY29tcGxldGVNb2R1bGUgfSBmcm9tICdAYW5ndWxhci9tYXRlcmlhbC9hdXRvY29tcGxldGUnO1xuaW1wb3J0IHsgTWF0Q2hpcElucHV0RXZlbnQsIE1hdENoaXBzTW9kdWxlIH0gZnJvbSAnQGFuZ3VsYXIvbWF0ZXJpYWwvY2hpcHMnO1xuaW1wb3J0IHsgbWVyZ2UsIE9ic2VydmFibGUgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IGRlYm91bmNlVGltZSwgZmlsdGVyLCBtYXAsIG1lcmdlTWFwLCBzdGFydFdpdGggfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyBBdXRvY29tcGxldGVTZXJ2aWNlIH0gZnJvbSAnLi4vYXV0b2NvbXBsZXRlL2F1dG9jb21wbGV0ZS5zZXJ2aWNlJztcbmltcG9ydCB7IElucHV0QmFzaWNDb21wb25lbnQsIElPcHRpb24gfSBmcm9tICcuLi9pbnB1dC9pbnB1dC5jb21wb25lbnQnO1xuaW1wb3J0IHsgSW5wdXRTZXJ2aWNlIH0gZnJvbSAnLi4vaW5wdXQvaW5wdXQuc2VydmljZSc7XG5pbXBvcnQgeyBGdW5jdGlvbkNhbGxlcjEgfSBmcm9tICcuLi8uLi9waXBlcy91dGlsaXR5LnBpcGUnO1xuaW1wb3J0IHsgTWF0T3B0aW9uTW9kdWxlIH0gZnJvbSAnQGFuZ3VsYXIvbWF0ZXJpYWwvY29yZSc7XG5pbXBvcnQgeyBNYXRJY29uTW9kdWxlIH0gZnJvbSAnQGFuZ3VsYXIvbWF0ZXJpYWwvaWNvbic7XG5pbXBvcnQgeyBOZ0ZvciwgTmdJZiwgQXN5bmNQaXBlIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJztcbmltcG9ydCB7IE1hdEZvcm1GaWVsZE1vZHVsZSB9IGZyb20gJ0Bhbmd1bGFyL21hdGVyaWFsL2Zvcm0tZmllbGQnO1xuXG5AQ29tcG9uZW50KHtcbiAgICBzZWxlY3RvcjogJ2NoaXAtbGlzdC1hdXRvY29tcGxldGUnLFxuICAgIHRlbXBsYXRlVXJsOiAnLi9jaGlwLWxpc3QtYXV0b2NvbXBsZXRlLmNvbXBvbmVudC5odG1sJyxcbiAgICBzdHlsZVVybHM6IFsnLi9jaGlwLWxpc3QtYXV0b2NvbXBsZXRlLmNvbXBvbmVudC5zY3NzJ10sXG4gICAgc3RhbmRhbG9uZTogdHJ1ZSxcbiAgICBpbXBvcnRzOiBbXG4gICAgICAgIE1hdEZvcm1GaWVsZE1vZHVsZSxcbiAgICAgICAgTWF0Q2hpcHNNb2R1bGUsXG4gICAgICAgIE5nRm9yLFxuICAgICAgICBNYXRJY29uTW9kdWxlLFxuICAgICAgICBGb3Jtc01vZHVsZSxcbiAgICAgICAgTWF0QXV0b2NvbXBsZXRlTW9kdWxlLFxuICAgICAgICBSZWFjdGl2ZUZvcm1zTW9kdWxlLFxuICAgICAgICBNYXRPcHRpb25Nb2R1bGUsXG4gICAgICAgIE5nSWYsXG4gICAgICAgIEFzeW5jUGlwZSxcbiAgICAgICAgRnVuY3Rpb25DYWxsZXIxLFxuICAgIF0sXG59KVxuZXhwb3J0IGNsYXNzIENoaXBMaXN0QXV0b2NvbXBsZXRlQ29tcG9uZW50PFxuICBURm9ybUdyb3VwIGV4dGVuZHMge1xuICAgIFtLIGluIGtleW9mIFRGb3JtR3JvdXBdOiBBYnN0cmFjdENvbnRyb2w8YW55LCBhbnk+O1xuICB9ID0gYW55LFxuICBUT3B0aW9uID0gYW55XG4+IGV4dGVuZHMgSW5wdXRCYXNpY0NvbXBvbmVudDxURm9ybUdyb3VwLCBzdHJpbmdbXSwgVE9wdGlvbj4ge1xuICBzZXBhcmF0b3JLZXlzQ29kZXM6IG51bWJlcltdID0gW0VOVEVSLCBDT01NQV07XG4gIGF1dG9Db21wbGV0ZUN0cmwgPSBuZXcgRm9ybUNvbnRyb2woJycpO1xuXG4gIEBJbnB1dCgpIGZpbHRlckZ1bmM6ICguLi5hcmdzKSA9PiBPYnNlcnZhYmxlPGFueVtdPjtcbiAgQFZpZXdDaGlsZCgnZnJ1aXRJbnB1dCcpIGZydWl0SW5wdXQ6IEVsZW1lbnRSZWY8SFRNTElucHV0RWxlbWVudD47XG4gIGZpbHRlcmVkT3B0aW9uczogSU9wdGlvbltdO1xuICBASW5wdXQoKSBhZGRlZERhdGFGb3JtYXR0ZXI6IChwYXJhbTogc3RyaW5nKSA9PiBPYnNlcnZhYmxlPHN0cmluZz47XG4gIG1lc3NhZ2U6IHN0cmluZztcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwdWJsaWMgb3ZlcnJpZGUgaVM6IElucHV0U2VydmljZSxcbiAgICBwdWJsaWMgYXV0b1M6IEF1dG9jb21wbGV0ZVNlcnZpY2VcbiAgKSB7XG4gICAgc3VwZXIoaVMpO1xuICB9XG5cbiAgb3ZlcnJpZGUgbmdPbkluaXQoKTogdm9pZCB7XG4gICAgc3VwZXIubmdPbkluaXQoKTtcblxuICAgIG1lcmdlKHRoaXMuYXV0b0NvbXBsZXRlQ3RybC52YWx1ZUNoYW5nZXMucGlwZShzdGFydFdpdGgoJycpKSwgdGhpcy5vcHRpb25zJClcbiAgICAgIC5waXBlKFxuICAgICAgICAvLyBmaWx0ZXIoKHIpID0+ICF0aGlzLmZpbHRlckZ1bmMpLFxuICAgICAgICBtZXJnZU1hcCgocikgPT5cbiAgICAgICAgICB0aGlzLmF1dG9TLmZpbHRlck9wdGlvbnMoXG4gICAgICAgICAgICB0aGlzLmF1dG9Db21wbGV0ZUN0cmwudmFsdWUgYXMgYW55LFxuICAgICAgICAgICAgdGhpcy5vcHRpb25zXG4gICAgICAgICAgKVxuICAgICAgICApXG4gICAgICApXG4gICAgICAuc3Vic2NyaWJlKChyKSA9PiB7XG4gICAgICAgIHRoaXMuZmlsdGVyZWRPcHRpb25zID0gcjtcbiAgICAgIH0pO1xuICAgIHRoaXMuYXV0b0NvbXBsZXRlQ3RybC52YWx1ZUNoYW5nZXNcbiAgICAgIC5waXBlKHN0YXJ0V2l0aCgnJykpXG4gICAgICAucGlwZShcbiAgICAgICAgZGVib3VuY2VUaW1lKDEwMDApLFxuICAgICAgICBmaWx0ZXIoKHIpID0+ICEhdGhpcy5maWx0ZXJGdW5jKSxcbiAgICAgICAgbWVyZ2VNYXAoKHIpID0+IHRoaXMuZmlsdGVyRnVuYyh0aGlzLmF1dG9Db21wbGV0ZUN0cmwudmFsdWUpKVxuICAgICAgKVxuICAgICAgLnN1YnNjcmliZSgocikgPT4ge1xuICAgICAgICB0aGlzLl9vcHRpb25zID0gciBhcyBhbnlbXTtcbiAgICAgIH0pO1xuICB9XG5cbiAgb3ZlcnJpZGUgbmdBZnRlclZpZXdJbml0KCk6IHZvaWQge1xuICAgIHN1cGVyLm5nQWZ0ZXJWaWV3SW5pdCgpO1xuICB9XG5cbiAgYWRkKGV2ZW50OiBNYXRDaGlwSW5wdXRFdmVudCk6IHZvaWQge1xuICAgIC8vIGNvbnN0IHZhbHVlID0gKGV2ZW50LnZhbHVlIHx8ICcnKS50cmltKCk7XG4gICAgLy8gLy8gQWRkIG91ciBmcnVpdFxuICAgIC8vIGlmICh2YWx1ZSkge1xuICAgIC8vICAgdGhpcy5jb250cm9sPy52YWx1ZS5wdXNoKHZhbHVlKTtcbiAgICAvLyB9XG4gICAgLy8gLy8gQ2xlYXIgdGhlIGlucHV0IHZhbHVlXG4gICAgLy8gZXZlbnQuY2hpcElucHV0IS5jbGVhcigpO1xuICAgIC8vIHRoaXMuYXV0b0NvbXBsZXRlQ3RybC5zZXRWYWx1ZShudWxsKTtcbiAgfVxuXG4gIHJlbW92ZShpbmRleDogbnVtYmVyKTogdm9pZCB7XG4gICAgdGhpcy5jb250cm9sPy52YWx1ZS5zcGxpY2UoaW5kZXgsIDEpO1xuICB9XG5cbiAgc2VsZWN0ZWQoZXZlbnQ6IE1hdEF1dG9jb21wbGV0ZVNlbGVjdGVkRXZlbnQpOiB2b2lkIHtcbiAgICBkZWxldGUgdGhpcy5tZXNzYWdlO1xuICAgIGlmICghdGhpcy5jb250cm9sPy52YWx1ZSkgdGhpcy5jb250cm9sPy5wYXRjaFZhbHVlKFtdKTtcbiAgICBpZiAodGhpcy5jb250cm9sPy52YWx1ZT8uaW5jbHVkZXMoZXZlbnQub3B0aW9uLnZhbHVlKSkge1xuICAgICAgdGhpcy5tZXNzYWdlID0gZXZlbnQub3B0aW9uLnZpZXdWYWx1ZSArICcgaGFzIGFscmVhZHkgYmVlbiBhZGRlZCc7XG4gICAgfSBlbHNlIHRoaXMuY29udHJvbD8udmFsdWUucHVzaChldmVudC5vcHRpb24udmFsdWUpO1xuICAgIC8vIHRoaXMuZnJ1aXRJbnB1dC5uYXRpdmVFbGVtZW50LnZhbHVlID0gJyc7XG4gICAgdGhpcy5hdXRvQ29tcGxldGVDdHJsLnNldFZhbHVlKG51bGwpO1xuICB9XG59XG4iLCI8bWF0LWZvcm0tZmllbGQgY2xhc3M9XCJleGFtcGxlLWNoaXAtbGlzdFwiIGFwcGVhcmFuY2U9XCJmaWxsXCI+XG4gICAgPG1hdC1sYWJlbD57e2xhYmVsfX08L21hdC1sYWJlbD5cbiAgICA8bWF0LWNoaXAtZ3JpZCAjY2hpcEdyaWQgYXR0ci5hcmlhLWxhYmVsPVwie3tsYWJlbH19IHNlbGVjdGlvblwiPlxuICAgICAgICA8bWF0LWNoaXAtcm93ICpuZ0Zvcj1cImxldCBpdGVtIG9mIGNvbnRyb2wudmFsdWU7bGV0IGkgPWluZGV4XCIgKHJlbW92ZWQpPVwicmVtb3ZlKGkpXCI+XG4gICAgICAgICAgICB7eyhhZGRlZERhdGFGb3JtYXR0ZXJ8ZnVuY3Rpb25DYWxsZXIxOml0ZW18YXN5bmMpfHxpdGVtfX1cbiAgICAgICAgICAgIDxidXR0b24gbWF0Q2hpcFJlbW92ZSBbYXR0ci5hcmlhLWxhYmVsXT1cIidyZW1vdmUgJyArIGl0ZW1cIj5cbiAgICAgICAgICAgICAgICA8bWF0LWljb24+Y2FuY2VsPC9tYXQtaWNvbj5cbiAgICAgICAgICAgIDwvYnV0dG9uPlxuICAgICAgICA8L21hdC1jaGlwLXJvdz5cbiAgICA8L21hdC1jaGlwLWdyaWQ+XG4gICAgPGlucHV0IHBsYWNlaG9sZGVyPVwie3twbGFjZWhvbGRlcnx8bGFiZWx9fVwiICNhSW5wdXQgW2Zvcm1Db250cm9sXT1cImF1dG9Db21wbGV0ZUN0cmxcIiBbbWF0Q2hpcElucHV0Rm9yXT1cImNoaXBHcmlkXCJcbiAgICAgICAgW21hdEF1dG9jb21wbGV0ZV09XCJhdXRvXCIgW21hdENoaXBJbnB1dFNlcGFyYXRvcktleUNvZGVzXT1cInNlcGFyYXRvcktleXNDb2Rlc1wiXG4gICAgICAgIChtYXRDaGlwSW5wdXRUb2tlbkVuZCk9XCJhZGQoJGV2ZW50KVwiIC8+XG4gICAgPG1hdC1hdXRvY29tcGxldGUgI2F1dG89XCJtYXRBdXRvY29tcGxldGVcIiAob3B0aW9uU2VsZWN0ZWQpPVwic2VsZWN0ZWQoJGV2ZW50KVwiPlxuICAgICAgICA8bWF0LW9wdGlvbiAqbmdGb3I9XCJsZXQgb3B0aW9uIG9mIGZpbHRlcmVkT3B0aW9uc1wiIFt2YWx1ZV09XCJvcHRpb24udmFsdWVcIj5cbiAgICAgICAgICAgIHt7b3B0aW9uLmxhYmVsfX1cbiAgICAgICAgPC9tYXQtb3B0aW9uPlxuICAgIDwvbWF0LWF1dG9jb21wbGV0ZT5cbjwvbWF0LWZvcm0tZmllbGQ+XG48ZGl2IGNsYXNzPVwidGV4dC1kYW5nZXJcIiAqbmdJZj1cIm1lc3NhZ2VcIj57e21lc3NhZ2V9fTwvZGl2PiJdfQ==